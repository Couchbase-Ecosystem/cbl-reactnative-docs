"use strict";(self.webpackChunkcbl_reactnative=self.webpackChunkcbl_reactnative||[]).push([[8226],{4378:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"scopes-collections","title":"Scopes and Collections","description":"Description \u2014 Scopes and collections allow you to organize your documents within a database.","source":"@site/docs/scopes-collections.md","sourceDirName":".","slug":"/scopes-collections","permalink":"/scopes-collections","draft":false,"unlisted":false,"editUrl":"https://github.com/Couchbase-Ecosystem/cbl-reactnative-docs/docs/scopes-collections.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"scopes-collections","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Pre-built Database","permalink":"/database-prebuilt"},"next":{"title":"Documents","permalink":"/documents"}}');var c=o(4848),l=o(8453);const i={id:"scopes-collections",sidebar_position:6},a="Scopes and Collections",s={},r=[{value:"Default Scopes and Collections",id:"default-scopes-and-collections",level:2},{value:"Create a Scope and Collection",id:"create-a-scope-and-collection",level:2},{value:"Index a Collection",id:"index-a-collection",level:2},{value:"Drop a Collection",id:"drop-a-collection",level:2},{value:"List Scopes and Collections",id:"list-scopes-and-collections",level:2},{value:"Get Collection Full Name",id:"get-collection-full-name",level:2},{value:"Collection Change Listeners",id:"collection-change-listeners",level:2},{value:"When to Use",id:"when-to-use",level:3},{value:"Data Structure",id:"data-structure",level:3},{value:"Example 6. Basic Collection Listener",id:"example-6-basic-collection-listener",level:4},{value:"Example 7. React Hook Pattern",id:"example-7-react-hook-pattern",level:4}];function d(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"scopes-and-collections",children:"Scopes and Collections"})}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["Description \u2014 ",(0,c.jsx)(n.em,{children:"Scopes and collections allow you to organize your documents within a database."})]}),"\n"]}),"\n",(0,c.jsxs)(n.admonition,{title:"AT A GLANCE",type:"important",children:[(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Use collections to organize your content in a database"})}),(0,c.jsx)(n.p,{children:"For example, if your database contains travel information, airport documents can be assigned to an airports collection, hotel documents can be assigned to a hotels collection, and so on."}),(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Document names must be unique within their collection."}),"\n"]}),(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Use scopes to group multiple collections"})}),(0,c.jsx)(n.p,{children:"Collections can be assigned to different scopes according to content-type or deployment-phase (for example, test versus production)."}),(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Collection names must be unique within their scope."}),"\n"]}),(0,c.jsx)(n.p,{children:"Unlike Couchbase Server and Capella, a scope cannot exist without a collection, thus there is no API to create a scope.  Instead, use the collection API to create a collection in a scope and the scope is created from that API."})]}),"\n",(0,c.jsx)(n.h2,{id:"default-scopes-and-collections",children:"Default Scopes and Collections"}),"\n",(0,c.jsxs)(n.p,{children:["Every database you create contains a default scope and a default collection named ",(0,c.jsx)(n.code,{children:"_default"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"If you create a document in the database and don't specify a specific scope or collection, it is saved in the default collection, in the default scope."}),"\n",(0,c.jsx)(n.p,{children:"If you upgrade from a version of Couchbase Lite prior to support for scops and collections, all existing data is automatically placed in the default scope and default collection."}),"\n",(0,c.jsx)(n.p,{children:"The default scope and collection cannot be dropped."}),"\n",(0,c.jsx)(n.h2,{id:"create-a-scope-and-collection",children:"Create a Scope and Collection"}),"\n",(0,c.jsx)(n.p,{children:"In addition to the default scope and collection, you can create your own scope and collection when you create a document."}),"\n",(0,c.jsx)(n.p,{children:"Naming conventions for collections and scopes:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Must be between 1 and 251 characters in length."}),"\n",(0,c.jsxs)(n.li,{children:["Can only contain the characters ",(0,c.jsx)(n.code,{children:"A-Z"}),", ",(0,c.jsx)(n.code,{children:"a-z"}),", ",(0,c.jsx)(n.code,{children:"0-9"}),", and the symbols ",(0,c.jsx)(n.code,{children:"_"}),", ",(0,c.jsx)(n.code,{children:"-"}),", and ",(0,c.jsx)(n.code,{children:"%"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Cannot start with ",(0,c.jsx)(n.code,{children:"_"})," or ",(0,c.jsx)(n.code,{children:"%"}),"."]}),"\n",(0,c.jsx)(n.li,{children:"Scope names must be unique in databases."}),"\n",(0,c.jsx)(n.li,{children:"Collection names must be unique within a scope."}),"\n"]}),"\n",(0,c.jsx)(n.admonition,{type:"note",children:(0,c.jsx)(n.p,{children:"Scope and collection names are case sensitive."})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example 1. Create a scope and collection"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'const scopeName = "myScopeName";  \nconst collectionName = "myCollectionName";  \nconst collection = await database.createCollection(collectionName, scopeName);\n'})}),"\n",(0,c.jsxs)(n.p,{children:["In the example above, you can see that ",(0,c.jsx)(n.code,{children:"Database.createCollection"})," can take two parameters. The second is the scope assigned to the created collection, if this parameter is omitted then a collection of the given name will be assigned to the ",(0,c.jsx)(n.code,{children:"_default"})," scope."]}),"\n",(0,c.jsxs)(n.p,{children:["The first parameter is the name of the collection you want to create, in this case ",(0,c.jsx)(n.code,{children:"myCollectionName"}),"."]}),"\n",(0,c.jsxs)(n.p,{children:["If a collection with the specified name already exists in the specified scope, ",(0,c.jsx)(n.code,{children:"Database.createCollection"})," returns the existing collection."]}),"\n",(0,c.jsx)(n.admonition,{type:"note",children:(0,c.jsxs)(n.p,{children:["You cannot create an empty user-defined scope. A scope is implicitly created and removed by the ",(0,c.jsx)(n.code,{children:"Database.createCollection"})," and ",(0,c.jsx)(n.code,{children:"Database.deleteCollection"})," methods."]})}),"\n",(0,c.jsx)(n.h2,{id:"index-a-collection",children:"Index a Collection"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example 2. Index a Collection"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:" // Define a value index on 'name' and 'documentType'\nconst valueIndex = IndexBuilder.valueIndex(\n    ValueIndexItem.property('name'),\n    ValueIndexItem.property('documentType')\n);\n\n// Create the value index\nconst valueIndexName = 'nameTypeIndex';\nawait collection.createIndex(valueIndexName, valueIndex);\n"})}),"\n",(0,c.jsx)(n.h2,{id:"drop-a-collection",children:"Drop a Collection"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example 3. Drop a Collection"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"await database.deleteCollection(collectionName, scopeName);\n"})}),"\n",(0,c.jsx)(n.h2,{id:"list-scopes-and-collections",children:"List Scopes and Collections"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example 4. List Scopes and Collections"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// Get Scopes\nconst scopes = await database.scopes();\n\n// Get Collections of a particular Scope\nconst collections = await database.collections(scopeName);\n"})}),"\n",(0,c.jsx)(n.h2,{id:"get-collection-full-name",children:"Get Collection Full Name"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"fullName()"}),' method returns the fully qualified name of a collection in the format "scope.collection".']}),"\n",(0,c.jsx)(n.p,{children:"The full name is useful for logging, debugging, and displaying collection information in your application."}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example 5. Get Collection Full Name"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"// User-defined collection\nconst collection = await database.createCollection('users', 'production');\nconst fullName = await collection.fullName();\nconsole.log(fullName);  \n// Output: \"production.users\"\n\n// Default collection\nconst defaultCol = await database.defaultCollection();\nconst defaultName = await defaultCol.fullName();\nconsole.log(defaultName);\n// Output: \"_default._default\"\n"})}),"\n",(0,c.jsx)(n.h2,{id:"collection-change-listeners",children:"Collection Change Listeners"}),"\n",(0,c.jsx)(n.p,{children:"Monitor all changes to any document in a collection."}),"\n",(0,c.jsx)(n.h3,{id:"when-to-use",children:"When to Use"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Refresh list views when data changes"}),"\n",(0,c.jsx)(n.li,{children:"Trigger background sync after local updates"}),"\n",(0,c.jsx)(n.li,{children:"Audit logging of collection activity"}),"\n",(0,c.jsx)(n.li,{children:"Real-time collaboration features"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"data-structure",children:"Data Structure"}),"\n",(0,c.jsxs)(n.p,{children:["When a collection changes, your callback receives a ",(0,c.jsx)(n.code,{children:"CollectionChange"})," object:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"interface CollectionChange {\n  documentIDs: string[];  // Array of changed document IDs\n  collection: Collection; // Reference to the collection\n}\n"})}),"\n",(0,c.jsxs)(n.admonition,{title:"Property Names",type:"caution",children:[(0,c.jsxs)(n.p,{children:["The property is ",(0,c.jsx)(n.code,{children:"documentIDs"})," (capital IDs), not ",(0,c.jsx)(n.code,{children:"documentIds"}),"."]}),(0,c.jsxs)(n.p,{children:["There is NO direct ",(0,c.jsx)(n.code,{children:"database"})," property. Access it via ",(0,c.jsx)(n.code,{children:"change.collection.database"}),"."]})]}),"\n",(0,c.jsx)(n.h4,{id:"example-6-basic-collection-listener",children:"Example 6. Basic Collection Listener"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"import { Collection, ListenerToken } from 'cbl-reactnative';\n\nconst collection = await database.createCollection('users');\n\nconst token: ListenerToken = await collection.addChangeListener((change) => {\n  console.log('Collection changed!');\n  console.log('Changed documents:', change.documentIDs);\n  // Example output: ['user-123', 'user-456']\n  \n  console.log('Collection name:', change.collection.name);\n  // Output: users\n  \n  console.log('Database name:', change.collection.database.getName());\n  // Output: mydb\n});\n\n// Remove listener when done\nawait token.remove();\n"})}),"\n",(0,c.jsx)(n.h4,{id:"example-7-react-hook-pattern",children:"Example 7. React Hook Pattern"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"import { useEffect } from 'react';\nimport { ListenerToken } from 'cbl-reactnative';\n\nfunction UserListScreen({ collection }) {\n  useEffect(() => {\n    if (!collection) return;\n\n    let token;\n    \n    const setup = async () => {\n      token = await collection.addChangeListener((change) => {\n        console.log(`${change.documentIDs.length} documents changed`);\n        refreshUserList();\n      });\n    };\n    setup();\n\n    // Cleanup on unmount\n    return () => {\n      if (token) token.remove();\n    };\n  }, [collection]);\n}\n"})}),"\n",(0,c.jsxs)(n.admonition,{title:"Limitation",type:"important",children:[(0,c.jsxs)(n.p,{children:["Only ONE collection-wide listener is allowed per collection instance. Calling ",(0,c.jsx)(n.code,{children:"addChangeListener"})," twice will throw an error."]}),(0,c.jsx)(n.p,{children:"However, you can have MULTIPLE document listeners on the same collection."})]}),"\n",(0,c.jsx)(n.admonition,{title:"Deprecated",type:"caution",children:(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"collection.removeChangeListener(token)"})," method is deprecated. It remains available for backward compatibility, but new applications should use ",(0,c.jsx)(n.code,{children:"token.remove()"}),". Existing applications are strongly encouraged to migrate."]})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>a});var t=o(6540);const c={},l=t.createContext(c);function i(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);