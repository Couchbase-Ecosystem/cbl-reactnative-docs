"use strict";(self.webpackChunkcbl_reactnative=self.webpackChunkcbl_reactnative||[]).push([[5702],{2174:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"Guides/Migration/migration-guide-v1","title":"Version 1.0","description":"Description \u2014 Quick reference for all API changes in cbl-reactnative version 1.0","source":"@site/docs/Guides/Migration/v1.md","sourceDirName":"Guides/Migration","slug":"/Guides/Migration/migration-guide-v1","permalink":"/Guides/Migration/migration-guide-v1","draft":false,"unlisted":false,"editUrl":"https://github.com/Couchbase-Ecosystem/cbl-reactnative-docs/docs/Guides/Migration/v1.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"migration-guide-v1","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting Crashes","permalink":"/Troubleshooting/troubleshoot-crashes"},"next":{"title":"Product Notes","permalink":"/category/product-notes"}}');var s=i(4848),o=i(8453);const r={id:"migration-guide-v1",sidebar_position:1},l="Version 1.0",c={},a=[{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"Listener Token Return Type (TypeScript)",id:"listener-token-return-type-typescript",level:3},{value:"Deprecated APIs",id:"deprecated-apis",level:2},{value:"1. Logging API",id:"1-logging-api",level:3},{value:"2. ReplicatorConfiguration API",id:"2-replicatorconfiguration-api",level:3},{value:"3. Listener Removal Methods (Deprecated)",id:"3-listener-removal-methods-deprecated",level:3},{value:"New Features in 1.0",id:"new-features-in-10",level:2},{value:"1. Three Log Sink Types",id:"1-three-log-sink-types",level:3},{value:"2. All 5 Change Listener Types",id:"2-all-5-change-listener-types",level:3},{value:"3. Collection.fullName()",id:"3-collectionfullname",level:3},{value:"Quick Migration Steps",id:"quick-migration-steps",level:2},{value:"Important Property Names",id:"important-property-names",level:2},{value:"Need Help?",id:"need-help",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"version-10",children:"Version 1.0"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Description \u2014 ",(0,s.jsx)(n.em,{children:"Quick reference for all API changes in cbl-reactnative version 1.0"}),(0,s.jsx)(n.br,{}),"\n","Related Content \u2014 ",(0,s.jsx)(n.a,{href:"/ProductNotes/release-notes",children:"Release Notes"})," | ",(0,s.jsx)(n.a,{href:"/Troubleshooting/using-logs",children:"Using Logs"})]}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{title:"AT A GLANCE",type:"important",children:[(0,s.jsx)(n.p,{children:"Version 1.0 introduces several API changes:"}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Log Sink API"})," - Replaces ",(0,s.jsx)(n.code,{children:"Database.setLogLevel()"})," with ",(0,s.jsx)(n.code,{children:"LogSinks"})," API"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Listener Token API"})," - New ",(0,s.jsx)(n.code,{children:"token.remove()"})," replaces ",(0,s.jsx)(n.code,{children:"removeChangeListener()"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"New ReplicatorConfiguration"})," - Collections passed in constructor"]}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"breaking-changes",children:"Breaking Changes"}),"\n",(0,s.jsx)(n.h3,{id:"listener-token-return-type-typescript",children:"Listener Token Return Type (TypeScript)"}),"\n",(0,s.jsxs)(n.p,{children:["We changed all ",(0,s.jsx)(n.code,{children:"addChangeListener"})," functions to return a ",(0,s.jsx)(n.code,{children:"ListenerToken"})," instead of a ",(0,s.jsx)(n.code,{children:"string"}),", enabling the new ",(0,s.jsx)(n.code,{children:"token.remove()"})," API and aligning with other platforms."]}),"\n",(0,s.jsxs)(n.p,{children:["This is a breaking change ",(0,s.jsx)(n.strong,{children:"only for TypeScript code"})," that explicitly typed the token as ",(0,s.jsx)(n.code,{children:"string"}),". JavaScript users and untyped TypeScript won't be affected."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TypeScript Migration Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// BEFORE (TypeScript compilation error in 1.0)\nconst token: string = await collection.addChangeListener(listener);\n\n// AFTER\nconst token: ListenerToken = await collection.addChangeListener(listener);\ntoken.remove();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The existing ",(0,s.jsx)(n.code,{children:"removeChangeListener(token)"})," methods remain available for backward compatibility but are deprecated."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"deprecated-apis",children:"Deprecated APIs"}),"\n",(0,s.jsx)(n.h3,{id:"1-logging-api",children:"1. Logging API"}),"\n",(0,s.jsxs)(n.p,{children:["The old ",(0,s.jsx)(n.code,{children:"Database.setLogLevel()"})," API is deprecated and replaced with the new ",(0,s.jsx)(n.code,{children:"LogSinks"})," API."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"OLD (Deprecated):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// This API is deprecated\nawait db.setLogLevel(LogDomain.ALL, LogLevel.VERBOSE);\nawait Database.setLogLevel(LogDomain.DATABASE, LogLevel.INFO);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NEW (Required in 1.0):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { LogSinks, LogLevel, LogDomain } from 'cbl-reactnative';\n\nawait LogSinks.setConsole({\n  level: LogLevel.VERBOSE,\n  domains: [LogDomain.ALL]\n});\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Important",type:"caution",children:(0,s.jsxs)(n.p,{children:["The old and new logging APIs cannot be used in tandem. If you are migrating to version 1.0, you must replace all instances of ",(0,s.jsx)(n.code,{children:"Database.setLogLevel()"})," with ",(0,s.jsx)(n.code,{children:"LogSinks.setConsole()"}),"."]})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Migration:"})," Search your code for ",(0,s.jsx)(n.code,{children:"setLogLevel"})," and replace with ",(0,s.jsx)(n.code,{children:"LogSinks.setConsole"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["See: ",(0,s.jsx)(n.a,{href:"/Troubleshooting/using-logs",children:"Using Logs"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"2-replicatorconfiguration-api",children:"2. ReplicatorConfiguration API"}),"\n",(0,s.jsxs)(n.p,{children:["The old constructor pattern using ",(0,s.jsx)(n.code,{children:"addCollection()"})," is deprecated."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"OLD (Deprecated):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const config = new ReplicatorConfiguration(endpoint);\nconfig.addCollection(collection);\nconst replicator = await Replicator.create(config);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NEW (Recommended in 1.0):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { CollectionConfiguration } from 'cbl-reactnative';\n\nconst collectionConfig = new CollectionConfiguration(collection);\nconst config = new ReplicatorConfiguration([collectionConfig], endpoint);\nconst replicator = await Replicator.create(config);\n"})}),"\n",(0,s.jsx)(n.p,{children:"This method is deprecated. It remains available for backward compatibility, but new applications should use the new constructor pattern. Existing applications are strongly encouraged to migrate."}),"\n",(0,s.jsxs)(n.p,{children:["See: ",(0,s.jsx)(n.a,{href:"/DataSync/remote-sync-gateway#example-1-replication-configuration-and-initialization",children:"Remote Sync"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"3-listener-removal-methods-deprecated",children:"3. Listener Removal Methods (Deprecated)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"OLD (Deprecated in 1.0):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"await collection.removeChangeListener(token);\nawait query.removeChangeListener(token);\nawait replicator.removeChangeListener(token);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"NEW (Recommended in 1.0):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"await token.remove();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This method is deprecated. It remains available for backward compatibility, but new applications should use ",(0,s.jsx)(n.code,{children:"token.remove()"}),". Existing applications are strongly encouraged to migrate."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"new-features-in-10",children:"New Features in 1.0"}),"\n",(0,s.jsx)(n.h3,{id:"1-three-log-sink-types",children:"1. Three Log Sink Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Console Sink - for development\nawait LogSinks.setConsole({ \n  level: LogLevel.VERBOSE, \n  domains: [LogDomain.ALL] \n});\n\n// File Sink - for production logging\nawait LogSinks.setFile({ \n  level: LogLevel.WARNING, \n  directory: logDir,\n  maxKeptFiles: 5,\n  maxFileSize: 1024 * 1024,\n  usePlaintext: true\n});\n\n// Custom Sink - for analytics\nawait LogSinks.setCustom({ \n  level: LogLevel.ERROR, \n  domains: [LogDomain.ALL],\n  callback: (level, domain, message) => {\n    Analytics.log({ level, domain, message });\n  }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["See: ",(0,s.jsx)(n.a,{href:"/Troubleshooting/using-logs",children:"Using Logs"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"2-all-5-change-listener-types",children:"2. All 5 Change Listener Types"}),"\n",(0,s.jsx)(n.p,{children:"Now fully documented with examples:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// 1. Collection Change Listener\nconst token1 = await collection.addChangeListener((change) => {\n  console.log('Changed docs:', change.documentIDs); // Capital IDs!\n});\n\n// 2. Document Change Listener\nconst token2 = await collection.addDocumentChangeListener('doc-id', (change) => {\n  console.log('Doc changed:', change.documentId); // Lowercase Id!\n});\n\n// 3. Query Change Listener (Live Query)\nconst token3 = await query.addChangeListener((change) => {\n  console.log('Results:', change.results);\n});\n\n// 4. Replicator Status Listener\nconst token4 = await replicator.addChangeListener((change) => {\n  const status = change.status;\n  console.log('Level:', status.getActivityLevel());\n  console.log('Progress:', status.getProgress().getCompleted());\n});\n\n// 5. Replicator Document Listener\nconst token5 = await replicator.addDocumentChangeListener((change) => {\n  console.log('Direction:', change.isPush ? 'Push' : 'Pull');\n});\n\n// All use same removal pattern\nawait token1.remove();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["See: ",(0,s.jsx)(n.a,{href:"/scopes-collections#collection-change-listeners",children:"Scopes and Collections"})," | ",(0,s.jsx)(n.a,{href:"/documents#document-change-listeners",children:"Documents"})," | ",(0,s.jsx)(n.a,{href:"/Queries/live-queries",children:"Live Queries"})," | ",(0,s.jsx)(n.a,{href:"/DataSync/remote-sync-gateway#change-listeners",children:"Remote Sync"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"3-collectionfullname",children:"3. Collection.fullName()"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const fullName = await collection.fullName();\nconsole.log(fullName); // "production.users"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["See: ",(0,s.jsx)(n.a,{href:"/scopes-collections#get-collection-full-name",children:"Scopes and Collections"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"quick-migration-steps",children:"Quick Migration Steps"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 1: Update Logging (Required)"})}),"\n",(0,s.jsx)(n.p,{children:"Find and replace in your code:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Search for old API\ngrep -r "setLogLevel" .\n\n# Replace with LogSinks.setConsole\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 2: Update ReplicatorConfiguration (Recommended)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Old (deprecated)\nconst config = new ReplicatorConfiguration(endpoint);\nconfig.addCollection(collection);\n\n// New (recommended)\nconst collectionConfig = new CollectionConfiguration(collection);\nconst config = new ReplicatorConfiguration([collectionConfig], endpoint);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 3: Update Listener Cleanup (Recommended)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Old (deprecated)\nawait collection.removeChangeListener(token);\n\n// New (recommended)\nawait token.remove();\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"important-property-names",children:"Important Property Names"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Listener Type"}),(0,s.jsx)(n.th,{children:"Property"}),(0,s.jsx)(n.th,{children:"Correct"}),(0,s.jsx)(n.th,{children:"Wrong"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Collection Change"}),(0,s.jsx)(n.td,{children:"Document IDs"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"documentIDs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"documentIds"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Document Change"}),(0,s.jsx)(n.td,{children:"Document ID"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"documentId"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"documentID"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Collection Change"}),(0,s.jsx)(n.td,{children:"Database"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"collection.database"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"database"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Document Change"}),(0,s.jsx)(n.td,{children:"Database"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"database"})}),(0,s.jsx)(n.td,{children:"N/A"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Replicator Progress"}),(0,s.jsx)(n.td,{children:"Completed"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"getCompleted()"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"completed"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Replicator Progress"}),(0,s.jsx)(n.td,{children:"Total"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"getTotal()"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"total"})})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"need-help",children:"Need Help?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Log Sink Examples:"})," ",(0,s.jsx)(n.a,{href:"/Troubleshooting/using-logs",children:"Using Logs"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Replication Setup:"})," ",(0,s.jsx)(n.a,{href:"/DataSync/remote-sync-gateway",children:"Remote Sync"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Full Release Notes:"})," ",(0,s.jsx)(n.a,{href:"/ProductNotes/release-notes",children:"Version 1.0"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var t=i(6540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);